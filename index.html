<html>
  <head>
    <meta charset="utf-8">
    <title>Hello SmartAppBanner</title>

    <link rel="manifest" href="manifest.json">

    <meta name="apple-itunes-app" content="app-id=1005030039">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body>
		<div align="center" style="background-color:#3399ff">
			<br/>
		    <h1>PoC SmartAppBanner</h1>
		    <img src="http://www.pole-emploi.fr/accueil/image/mmlelement/pj/a3/ab/6f/28/new-cover-tinified20649.jpg">
		    <br/>
        <button id="btnSave" disabled>Affiche banner</button>
		    <br/>
		</div>
    <script>
      window.addEventListener('load', function() {
  
        var outputElement = document.getElementById('output');
        var btnSave = document.getElementById('btnSave');
        var deferredPrompt;
  
        navigator.serviceWorker.register('service-worker.js', { scope: './' })
          .then(function(r) {
            console.log('registered service worker');
          })
          .catch(function(whut) {
            console.error('uh oh... ');
            console.error(whut);
          });
        
        window.addEventListener('beforeinstallprompt', function(e) {
          console.log('beforeinstallprompt Event fired');
          e.preventDefault();
          
          // Enable the button.
          btnSave.removeAttribute('disabled');
          
          // Stash the event so it can be triggered later.
          deferredPrompt = e;
          
          return false;
        });
        
        btnSave.addEventListener('click', function() {
          if (deferredPrompt !== undefined) {
            // The user has had a postive interaction with our app and Chrome
            // has tried to prompt previously, so let's show the prompt.
            deferredPrompt.prompt();
            
            outputElement.textContent = 'Deferred Prompt shown';
          
            // Follow what the user has selected.
            deferredPrompt.userChoice.then(function(choiceResult) {
              
              console.log(choiceResult.outcome);
              
              if (choiceResult.outcome == 'dismissed') {
                console.log('User cancelled homescreen install');
              }
              else {
                console.log('User added to homescreen');
              }
              
              // We no longer need the prompt.  Clear it up.
              deferredPrompt = null;
            });
          }
        });
      });
    </script>
  </body>
</html>